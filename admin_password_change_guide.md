# ç®¡ç†å‘˜ä¿®æ”¹å¯†ç åŠŸèƒ½è¯´æ˜

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

åœ¨åå°ç®¡ç†ç³»ç»Ÿä¸­æ·»åŠ äº†ä¿®æ”¹ç®¡ç†å‘˜å¯†ç çš„åŠŸèƒ½ï¼Œç®¡ç†å‘˜å¯ä»¥è‡ªåŠ©ä¿®æ”¹å¯†ç ï¼Œæ— éœ€æŠ€æœ¯äººå‘˜ä»‹å…¥ã€‚

## âœ¨ æ–°å¢å†…å®¹

### 1. åç«¯APIæ¥å£

**è·¯å¾„**ï¼š`POST /admin/api/change-password`

**åŠŸèƒ½**ï¼šä¿®æ”¹å½“å‰ç™»å½•ç®¡ç†å‘˜çš„å¯†ç 

**è¯·æ±‚å‚æ•°**ï¼š
```json
{
  "old_password": "æ—§å¯†ç ",
  "new_password": "æ–°å¯†ç ",
  "confirm_password": "ç¡®è®¤æ–°å¯†ç "
}
```

**éªŒè¯è§„åˆ™**ï¼š
- âœ… æ‰€æœ‰å­—æ®µå¿…å¡«
- âœ… æ—§å¯†ç å¿…é¡»æ­£ç¡®
- âœ… æ–°å¯†ç é•¿åº¦è‡³å°‘6ä½
- âœ… ä¸¤æ¬¡è¾“å…¥çš„æ–°å¯†ç å¿…é¡»ä¸€è‡´

**è¿”å›ç»“æœ**ï¼š
```json
{
  "success": true,
  "message": "å¯†ç ä¿®æ”¹æˆåŠŸï¼Œè¯·é‡æ–°ç™»å½•"
}
```

### 2. å‰ç«¯ç•Œé¢

**ä½ç½®**ï¼šç®¡ç†åå°é¦–é¡µ â†’ å¿«é€Ÿæ“ä½œåŒºåŸŸ

**æŒ‰é’®**ï¼šğŸ” ä¿®æ”¹å¯†ç 

**åŠŸèƒ½**ï¼š
1. ç‚¹å‡»æŒ‰é’®å¼¹å‡ºä¿®æ”¹å¯†ç å¯¹è¯æ¡†
2. å¡«å†™åŸå¯†ç ã€æ–°å¯†ç ã€ç¡®è®¤æ–°å¯†ç 
3. æäº¤åè‡ªåŠ¨éªŒè¯
4. ä¿®æ”¹æˆåŠŸåè‡ªåŠ¨è·³è½¬åˆ°ç™»å½•é¡µ

## ğŸ¯ ä½¿ç”¨æ­¥éª¤

### æ­¥éª¤1ï¼šç™»å½•ç®¡ç†åå°
è®¿é—®ï¼š`http://your-server:port/admin/`
ä½¿ç”¨å½“å‰ç®¡ç†å‘˜è´¦å·å¯†ç ç™»å½•

### æ­¥éª¤2ï¼šæ‰“å¼€ä¿®æ”¹å¯†ç å¯¹è¯æ¡†
åœ¨é¦–é¡µæ‰¾åˆ°**å¿«é€Ÿæ“ä½œ**åŒºåŸŸï¼Œç‚¹å‡» **ğŸ” ä¿®æ”¹å¯†ç ** æŒ‰é’®

### æ­¥éª¤3ï¼šå¡«å†™å¯†ç ä¿¡æ¯
- **åŸå¯†ç **ï¼šè¾“å…¥å½“å‰ä½¿ç”¨çš„å¯†ç 
- **æ–°å¯†ç **ï¼šè¾“å…¥æ–°çš„å¯†ç ï¼ˆè‡³å°‘6ä½ï¼‰
- **ç¡®è®¤æ–°å¯†ç **ï¼šå†æ¬¡è¾“å…¥æ–°å¯†ç 

### æ­¥éª¤4ï¼šæäº¤ä¿®æ”¹
ç‚¹å‡» **ç¡®è®¤ä¿®æ”¹** æŒ‰é’®

### æ­¥éª¤5ï¼šé‡æ–°ç™»å½•
ä¿®æ”¹æˆåŠŸåä¼šè‡ªåŠ¨è·³è½¬åˆ°ç™»å½•é¡µï¼Œä½¿ç”¨æ–°å¯†ç ç™»å½•å³å¯

## âš ï¸ æ³¨æ„äº‹é¡¹

### å®‰å…¨æç¤º
1. **è¯·å¦¥å–„ä¿ç®¡æ–°å¯†ç **ï¼Œä¸¢å¤±åéœ€è¦æ•°æ®åº“ç®¡ç†å‘˜é‡ç½®
2. **å»ºè®®å®šæœŸä¿®æ”¹å¯†ç **ï¼Œæé«˜è´¦å·å®‰å…¨æ€§
3. **å¯†ç è‡³å°‘6ä½**ï¼Œå»ºè®®ä½¿ç”¨å­—æ¯+æ•°å­—+ç¬¦å·ç»„åˆ
4. **ä¸è¦ä½¿ç”¨ç®€å•å¯†ç **ï¼Œå¦‚123456ã€adminç­‰

### å¸¸è§é—®é¢˜

**Q1ï¼šå¿˜è®°åŸå¯†ç æ€ä¹ˆåŠï¼Ÿ**
A1ï¼šéœ€è¦é€šè¿‡æ•°æ®åº“ç›´æ¥ä¿®æ”¹ï¼Œæˆ–è”ç³»æŠ€æœ¯äººå‘˜é‡ç½®ã€‚

**Q2ï¼šä¿®æ”¹å¯†ç åå…¶ä»–è®¾å¤‡ä¼šè¢«ç™»å‡ºå—ï¼Ÿ**
A2ï¼šä¼šçš„ï¼Œæ‰€æœ‰å·²ç™»å½•çš„è®¾å¤‡éƒ½éœ€è¦é‡æ–°ç™»å½•ã€‚

**Q3ï¼šå¯†ç æœ‰å¤æ‚åº¦è¦æ±‚å—ï¼Ÿ**
A3ï¼šå½“å‰åªè¦æ±‚è‡³å°‘6ä½ï¼Œå»ºè®®ä½¿ç”¨å¤æ‚å¯†ç å¢å¼ºå®‰å…¨æ€§ã€‚

**Q4ï¼šå¯ä»¥ä¿®æ”¹å›åŸæ¥çš„å¯†ç å—ï¼Ÿ**
A4ï¼šå¯ä»¥ï¼Œç³»ç»Ÿä¸é™åˆ¶ä½¿ç”¨æ—§å¯†ç ã€‚

## ğŸ”§ æ–‡ä»¶ä¿®æ”¹æ¸…å•

### åç«¯æ–‡ä»¶
- `backend/routers/admin_router.py`
  - æ–°å¢ `change_admin_password()` å‡½æ•°
  - å¤„ç†å¯†ç ä¿®æ”¹è¯·æ±‚
  - éªŒè¯æ—§å¯†ç å¹¶æ›´æ–°æ–°å¯†ç 

### å‰ç«¯æ–‡ä»¶
- `backend/templates/admin/dashboard.html`
  - æ–°å¢"ä¿®æ”¹å¯†ç "æŒ‰é’®
  - æ–°å¢ä¿®æ”¹å¯†ç æ¨¡æ€æ¡†HTML
  - æ–°å¢ `showChangePasswordModal()` å‡½æ•°
  - æ–°å¢ `hideChangePasswordModal()` å‡½æ•°
  - æ–°å¢ `changePassword()` å‡½æ•°

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### 1. æ›´æ–°ä»£ç 
```bash
git pull origin main
```

### 2. é‡å¯åç«¯æœåŠ¡
```bash
cd backend
sudo systemctl restart game-backend
```

### 3. éªŒè¯åŠŸèƒ½
1. ç™»å½•ç®¡ç†åå°
2. ç‚¹å‡»"ä¿®æ”¹å¯†ç "æŒ‰é’®
3. æµ‹è¯•ä¿®æ”¹å¯†ç åŠŸèƒ½

## ğŸ›¡ï¸ å®‰å…¨æ€§

### å¯†ç åŠ å¯†
- ä½¿ç”¨ SHA-256 å“ˆå¸Œç®—æ³•
- å¯†ç ä¸ä»¥æ˜æ–‡å­˜å‚¨
- å³ä½¿æ•°æ®åº“æ³„éœ²ä¹Ÿæ— æ³•è¿˜åŸåŸå§‹å¯†ç 

### ä¼šè¯ç®¡ç†
- ä¿®æ”¹å¯†ç åè‡ªåŠ¨æ¸…é™¤å½“å‰ä¼šè¯
- å¼ºåˆ¶ç”¨æˆ·é‡æ–°ç™»å½•
- é˜²æ­¢å¯†ç ä¿®æ”¹åçš„å®‰å…¨éšæ‚£

### æƒé™æ§åˆ¶
- åªæœ‰å·²ç™»å½•çš„ç®¡ç†å‘˜æ‰èƒ½ä¿®æ”¹å¯†ç 
- å¿…é¡»éªŒè¯åŸå¯†ç æ‰èƒ½ä¿®æ”¹
- é˜²æ­¢æœªæˆæƒçš„å¯†ç ä¿®æ”¹

## ğŸ“ ä»£ç ç¤ºä¾‹

### åç«¯APIè°ƒç”¨ç¤ºä¾‹
```python
# ä¿®æ”¹å¯†ç API
@router.post("/api/change-password")
async def change_admin_password(request: Request, db: Session = Depends(get_db)):
    # éªŒè¯ç™»å½•çŠ¶æ€
    admin_id = verify_admin(request)
    if not admin_id:
        return JSONResponse(
            content={"success": False, "message": "æœªç™»å½•æˆ–ç™»å½•å·²è¿‡æœŸ"},
            status_code=401
        )
    
    # è·å–è¯·æ±‚å‚æ•°
    body = await request.json()
    old_password = body.get("old_password", "")
    new_password = body.get("new_password", "")
    
    # éªŒè¯æ—§å¯†ç 
    admin = db.query(Admin).filter(Admin.id == admin_id).first()
    old_password_hash = hash_password(old_password)
    if admin.password_hash != old_password_hash:
        return JSONResponse(
            content={"success": False, "message": "åŸå¯†ç é”™è¯¯"},
            status_code=400
        )
    
    # æ›´æ–°å¯†ç 
    new_password_hash = hash_password(new_password)
    admin.password_hash = new_password_hash
    db.commit()
    
    return JSONResponse(
        content={"success": True, "message": "å¯†ç ä¿®æ”¹æˆåŠŸ"}
    )
```

### å‰ç«¯è°ƒç”¨ç¤ºä¾‹
```javascript
async function changePassword(event) {
    event.preventDefault();
    
    const response = await fetch('/admin/api/change-password', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({
            old_password: oldPassword,
            new_password: newPassword,
            confirm_password: confirmPassword
        })
    });
    
    const data = await response.json();
    
    if (data.success) {
        alert('å¯†ç ä¿®æ”¹æˆåŠŸï¼Œè¯·é‡æ–°ç™»å½•');
        window.location.href = '/admin/login';
    } else {
        alert(data.message);
    }
}
```

## ğŸ¨ ç•Œé¢æˆªå›¾è¯´æ˜

1. **å¿«é€Ÿæ“ä½œåŒºåŸŸ**
   - æ˜¾ç¤º"ğŸ” ä¿®æ”¹å¯†ç "æŒ‰é’®
   - ä¸å…¶ä»–å¿«é€Ÿæ“ä½œæŒ‰é’®å¹¶åˆ—

2. **ä¿®æ”¹å¯†ç å¯¹è¯æ¡†**
   - è¾“å…¥åŸå¯†ç 
   - è¾“å…¥æ–°å¯†ç ï¼ˆè‡³å°‘6ä½ï¼‰
   - ç¡®è®¤æ–°å¯†ç 
   - æ˜¾ç¤ºæ³¨æ„äº‹é¡¹
   - å–æ¶ˆ/ç¡®è®¤ä¿®æ”¹æŒ‰é’®

3. **æˆåŠŸæç¤º**
   - æ˜¾ç¤º"å¯†ç ä¿®æ”¹æˆåŠŸï¼Œè¯·é‡æ–°ç™»å½•"
   - è‡ªåŠ¨è·³è½¬åˆ°ç™»å½•é¡µ

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·è”ç³»æŠ€æœ¯æ”¯æŒæˆ–æŸ¥çœ‹æ—¥å¿—ï¼š
```bash
# æŸ¥çœ‹åç«¯æ—¥å¿—
sudo journalctl -u game-backend -f
```

---

**ä¿®æ”¹æ—¶é—´**ï¼š2025-10-21  
**ç‰ˆæœ¬**ï¼šv1.0  
**çŠ¶æ€**ï¼šâœ… å·²å®Œæˆ

